<!doctype html>
<html>
  <head>
    <title>Swatchr</title>
    <script src="/js/vendor/jquery-2.1.3.min.js"></script>
    <link href="/css/codemirror/codemirror.css" rel="stylesheet" />
    <link href="/css/codemirror/material.css" rel="stylesheet" />
    <style id="dynamic-style-target"></style>
  </head>
  <body>
    <settings></settings>
    <editor></editor>

   <iframe id="browser-preview" width="100%" src="/preview.html"></iframe>

    <!-- <script src="/js/vendor/less.min.js"></script> -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/less.js/2.5.3/less.js"></script>
    <script src="/js/vendor/codemirror.js"></script>
    <script src="/js/vendor/modes/css.js"></script>
    <script src="/tags/settings.tag" type="riot/tag"></script>
    <script src="/tags/preview.tag" type="riot/tag"></script>
    <script src="/tags/editor.tag" type="riot/tag"></script>
    <!-- <script src="/js/vendor/riot-compiler.min.js"></script> -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/riot/2.3.1/riot+compiler.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/3.5.1/iframeResizer.js"></script>
    <script>
      function Swatchr(){
        riot.observable(this);

        this.frameworks = [];
        this.previews = [];
        this.currentPreview = false;
        this.currentFramework = false;

        this.cache = {
          vars:{},
          libs:{},
          imports: {}
        };

        function getDef(list){
          var found = false;
          list.forEach(function(item){
            if(item.default){
              found = item;
            }
          });
          return found;
        }

        this.setPreviewByIndex = function(indx){
          this.currentPreview = this.previews[indx];
          this.trigger('preview-changed');
        }

        this.setFrameworkByIndex = function(indx){
          this.currentFramework = this.frameworks[indx];
          this.trigger('framework-changed');
        }

        var me = this;
        $.get('/content/frameworks/active.json', function(data){
          me.frameworks = data;
          me.currentFramework = getDef(me.frameworks);
          debugger;
          me.trigger('updated-frameworks')
        });
        $.get('/content/previews/active.json', function(data){
          me.previews = data;
          me.currentPreview = getDef(me.previews);
          me.trigger('updated-previews')
        });
      }

      var appState = new Swatchr();
      riot.mount('*');
      $('iframe').iFrameResize(  );
    </script>
  </body>
</html>
